#!/bin/sh -e
#
# dewr is a development wrapper

# For image name use full path but drop leading slash
IMAGE=$(echo $PWD | cut -c2-)

build() {
  docker build -f ci/Dockerfile -t "$IMAGE" .
}

run() {
  docker run --rm --net=host "$@"
}

case "$1" in
  build)
    build
    ;;
  run)
    shift
    run "$IMAGE" "$@"
    ;;
  sh)
    run -it -v $PWD:/opt/app "$IMAGE"
    ;;
  test)
    build
    run "$IMAGE" ci/test
    ;;
  *)
    cat <<EOF
usage: dewr <command>

commands:
  build  build container
  run    run [command] in container
  sh     run default command in container with working directory mounted
  test   build then run tests in container
EOF
    exit 1
esac
